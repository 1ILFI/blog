@page "/admin/login"

@inject AdminAuthService AuthService
@inject NavigationManager NavigationManager
@layout MainLayout

<PageTitle>管理员登录</PageTitle>

<div class="admin-login-container">
    <FluentCard class="admin-login-card">
        <FluentStack Orientation="Orientation.Vertical" VerticalGap="12">
            <h2>管理后台登录</h2>
            
            @if (showError)
            {
                <FluentMessageBar Intent="MessageIntent.Error" Title="登录失败">
                    用户名或密码错误，请重试
                </FluentMessageBar>
            }
            
            <FluentTextField @bind-Value="password" Type="password" Label="管理员密码" Placeholder="请输入密码" Required="true" />
            
            <FluentButton Appearance="Appearance.Accent" OnClick="HandleLogin" Loading="@isLoading" IconEnd="@(new Icons.Regular.Size20.ArrowEnter())">
                登录
            </FluentButton>
            
            <p class="login-hint">首次登录默认密码: admin123</p>
            <p class="login-hint">请登录后立即修改默认密码</p>
        </FluentStack>
    </FluentCard>
</div>

<style>
    .admin-login-container {
        display: flex;
        justify-content: center;
        align-items: center;
        min-height: 80vh;
        padding: 1rem;
    }
    
    .admin-login-card {
        width: 100%;
        max-width: 400px;
        padding: 2rem;
    }
    
    .login-hint {
        margin-top: 0.5rem;
        font-size: 0.85rem;
        color: #666;
    }
</style>

@code {
    private string password = "";
    private bool showError = false;
    private bool isLoading = false;
    
    protected override async Task OnInitializedAsync()
    {
        // 如果已经登录，直接跳转到管理后台
        if (await AuthService.IsLoggedInAsync())
        {
            NavigationManager.NavigateTo("/admin");
        }
    }
    
    private async Task HandleLogin()
    {
        isLoading = true;
        showError = false;
        
        var success = await AuthService.LoginAsync(password);
        
        if (success)
        {
            NavigationManager.NavigateTo("/admin");
        }
        else
        {
            showError = true;
        }
        
        isLoading = false;
    }
}